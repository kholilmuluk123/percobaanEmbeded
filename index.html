<!DOCTYPE html>
<html>
<head>
  <title>Indikator Polusi Udara </title>

  <!-- FONT -->
  <link href="https://pktgokil-default-rtdb.firebaseio.com/">

  <!-- CHART JS -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      font-family: 'Orbitron', sans-serif;
      background: #ffffff;
      color: #000000;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .container {
      max-width: 850px;
      background: #ffffff;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      text-align: center;
      border: 1px solid #e0e0e0;
    }

    h1 {
      color: #0077cc;
      text-shadow: 0 0 5px rgba(0, 119, 204, 0.4);
      margin-bottom: 20px;
    }

    .data-card {
      background: #f7f7f7;
      padding: 15px;
      margin: 10px 0;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
    }

    .data-card:hover {
      transform: scale(1.03);
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
    }

    .data-label {
      font-size: 1.2em;
      color: #222;
    }

    .data-value {
      font-size: 1.5em;
      font-weight: bold;
      color: #000;
    }

    .status-high { color: #d00000; font-weight: bold; }
    .status-medium { color: #cc7700; font-weight: bold; }
    .status-clean { color: #0088cc; font-weight: bold; }

    .refresh-btn {
      background: #0077cc;
      color: #fff;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      font-size: 1em;
      cursor: pointer;
      margin-top: 20px;
      transition: 0.3s;
    }

    .refresh-btn:hover {
      background: #005fa3;
    }

    canvas {
      margin-top: 20px;
      background: #f7f7f7;
      border-radius: 10px;
      padding: 10px;
    }
  </style>
</head>

<body>
<div class="container">
  <h1>Realtime Monitoring Sensor</h1>

  <div class="data-card">
    <div class="data-label">Waktu</div>
    <div class="data-value" id="waktu"> --:--:-- </div>
  </div>

  <div class="data-card">
    <div class="data-label">MQ-7 (CO)</div>
    <div class="data-value" id="mq7"> -- </div>
  </div>

  <div class="data-card">
    <div class="data-label">MQ-135 (Gas)</div>
    <div class="data-value" id="mq135"> -- </div>
  </div>

  <div class="data-card">
    <div class="data-label">Debu (GP2Y1010)</div>
    <div class="data-value" id="dust"> -- </div>
  </div>

  <div class="data-card">
    <div class="data-label">Status</div>
    <div class="data-value" id="status"> -- </div>
  </div>

  <canvas id="chart" height="150"></canvas>
  <button class="refresh-btn" onclick="getData()">Refresh</button>
</div>

<script>
  const url = "https://pktgokil-default-rtdb.firebaseio.com/iot/sensor.json";

  let mq7Data = [];
  let mq135Data = [];
  let dustData = [];
  let labels = [];
  const maxPoints = 10;

  const ctx = document.getElementById("chart").getContext("2d");
  const chart = new Chart(ctx, {
    type: "line",
    data: {
      labels: labels,
      datasets: [
        {
          label: "MQ-7",
          data: mq7Data,
          borderColor: "#d00000",
          backgroundColor: "rgba(208,0,0,0.2)",
          fill: true,
          tension: 0.4
        },
        {
          label: "MQ-135",
          data: mq135Data,
          borderColor: "#0077cc",
          backgroundColor: "rgba(0,119,204,0.2)",
          fill: true,
          tension: 0.4
        },
        {
          label: "Debu GP2Y",
          data: dustData,
          borderColor: "#009900",
          backgroundColor: "rgba(0,153,0,0.2)",
          fill: true,
          tension: 0.4
        }
      ]
    }
  });

  function getStatus(m7, m135, dust) {
    if (m7 > 700 || m135 > 700 || dust > 500) return "TINGGI";
    if (m7 > 300 || m135 > 300 || dust > 200) return "SEDANG";
    return "BERSIH";
  }

  async function getData() {
    try {
      const res = await fetch(url);
      const d = await res.json();

      document.getElementById("waktu").textContent = d.waktu;
      document.getElementById("mq7").textContent = d.mq7;
      document.getElementById("mq135").textContent = d.mq135;
      document.getElementById("dust").textContent = d.dust;

      const status = getStatus(d.mq7, d.mq135, d.dust);
      const statusEl = document.getElementById("status");
      statusEl.textContent = status;

      statusEl.className = "data-value " +
        (status === "TINGGI" ? "status-high" :
         status === "SEDANG" ? "status-medium" : "status-clean");

      labels.push(d.waktu);
      mq7Data.push(d.mq7);
      mq135Data.push(d.mq135);
      dustData.push(d.dust);

      if (labels.length > maxPoints) {
        labels.shift(); mq7Data.shift(); mq135Data.shift(); dustData.shift();
      }

      chart.update();

    } catch (e) {
      console.log("Error fetching:", e);
    }
  }

  setInterval(getData, 1000);
  getData();
</script>

</body>
</html>


